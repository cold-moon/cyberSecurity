# 第十一章、DNS部署与安全

## 1、DNS

Domain Name Service
域名服务
作用：为客户机提供域名解析服务器

## 2、域名组成

### 2.1、域名组成概述

如"www.sina.com.cn"是一个域名，从严格意义上讲，"sina.com.cn"才被称为域名(全球唯一)，而"www"是主机名。
"主机名.域名"称为完全限定域名(FQDN)。一个域名下可以有多个主机，域名全球唯一，那么"主机名.域名"肯定也是全球唯一的。
以"sina.com.cn"域名为例，一般管理员在命名其主机的时候会根据其主机的功能而命名，比如网站的是www，博客的是blog，论坛的是bbs，那么对应的FQDN为www.sina.com.cn，blog.sina.com.cn，bbs.sina.com.cn。这么多个FQDN，然而我们只需要申请一个域名即"sina.com.cn"即可。

### 2.2、域名组成

树形结构
根域 . 
顶级域
 国家顶级域 cn jp hk uk
 商业顶级域
 com 商业机构
 gov 政府机构
 mil 军事机构
 edu 教育机构
 org 民间组织架构
 net 互联网
一级域名
二级域名
。。。。

如：www.baidu.com. .为根域 
.com为顶级域 
baidu为一级域名 
www为主机名 
FQDN=主机名.DNS后缀 
FQDN（完整合格的域名）

## 3、监听端口

TCP53 UDP53

## 4、DNS解析种类

### 4.1、按照查询方式分类：

1）递归查询：客户机与本地DNS服务器之间 
2）迭代查询：本地DNS服务器与根等其他DNS服务器的解析过程

### 4.2、按照查询内容分类：
 
1）正向解析：已知域名，解析IP地址
2）反向解析：已知IP地址，解析域名

## 5、DNS服务器搭建过程

1）要求网卡IP是静态IP地址。
2）安装DNS服务器插件（也就是安装并开启TCP及UDP53端口）
3）创建区域文件（负责一个域名后缀的解析，如baidu.com为域名后缀，一台DNS服务器内可存放多个区域文件）
4）新建A记录

## 6、DNS客户机如何解析

1）指向DNS
2）手工解析域名：
nslookup 域名

## 7、DNS服务器处理域名请求的顺序

1）DNS高速缓存（必须学会如何查看及清空）
2）DNS区域配置文件
3）DNS转发器
4）根提示

## 8、辅助DNS服务器

## 9、清除DNS缓存

### 9.1、客户机上清除缓存

ipconfig /flushdns

### 9.2、服务器上清除缓存

windows服务器：dns工具--查看--高级，调出缓存来，然后右键清除缓存

## 10、域名解析记录类型：

A记录： 正向解析记录
CNAME记录：别名
PTR记录：反向解析记录
MX：邮件交换记录
NS：域名服务器解析

## 11、反向DNS

nslookup手工解析时，会进行一个反向解析

## 12、DNS服务器分类

主要名称服务器
辅助名称服务器
根名称服务器
高速缓存名称服务器

## 13、客户机域名请求解析顺序

1.DNS缓存----2.本地hosts文件--3.找本地DNS服务器

## 14、服务器对域名请求的处理顺序

1.DNS高速缓存--2.本地区域解析文件--3.转发器--4.根

# 第十二章、DHCP部署与安全

## 1、DHCP作用

（Dynamic Host Configure Protocol）自动分配IP地址

## 2、DHCP相关概念

地址池/作用域：（IP、子网掩码、网关、DNS、租期），DHCP协议端口是UDP 67/68

## 3、DHCP优点

减少工作量、避免IP冲突、提高地址利用率

## 4、DHCP原理

也成为DHCP租约过程，分为4个步骤：
1）客户机发送DHCP Discovery广播包
    客户机广播请求IP地址（包含客户机的MAC地址）
2）服务器响应DHCP Offer广播包
    服务器响应提供的IP地址（但无子网掩码、网关等参数）
3）客户机发送DHCP Request广播包
    客户机选择IP（也可认为确认使用哪个IP） 
4）服务器发送DHCP ACK广播包
    服务器确定了租约，并提供网卡详细参数IP、掩码、网关、DNS、租期等

## 5、DHCP续约

当50%过后，客户机会再次发送DHCP Request包，进行续约，如服务器无响应，则继续使用并在87.5%再次DHCP Request包，进行续约，如仍然无响应，并释放IP地址，及重新发送DHCP Discovery广播包来获取IP地址当无任何服务器响应时，自动给自己分配一个169.254.x.x/16,属于全球统一无效地址，用于临时内网通信！

## 6、部署DHCP服务器

1）IP地址固定（服务器必须固定IP地址）
2）安装DHCP服务插件
3）新建作用域及作用域选项
4）激活
5）客户机验证：

ipconfig /release 释放IP（取消租约，或者改为手动配置IP，也可以释放租约） ipconfig /renew 重新获取IP（有IP时，发送request续约，无IP时发送Discovery重新获取IP）

## 7、地址保留

这对指定的MAC地址，固定动态分配IP地址

## 8、选项优先级

作用域选项>服务器选项
**当服务器上有多个作用域时，可以在服务器选项上设置DNS服务器

## 9、DHCP备份

备份服务器的所有作用域，当服务器宕机后，可以使用备份文件在其他DHCP服务器上进行还原所有配置

## 10、DHCP攻击与防御

1）攻击DHCP服务器：频繁的发送伪装DHCP请求，直到将DHCP地址池资源耗尽
防御：在交换机（管理型）的端口上做动态MAC地址绑定
2）伪装DHCP服务器攻击：hack通过将自己部署为DHCP服务器，为客户机提供非法ip地址
防御：在交换机上（管理型），除合法的DHCP服务器所在接口外，全部设置为禁止发送dhcp offer包