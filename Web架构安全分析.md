# Web工作机制

网址 
  本地缓存
  host
  IP/ARP
  DNS
  IP
  网关
  路由
  到达对方主机
  访问80 443
  3次握手
  建立连接
  HTTP 数据包
  HTTP响应包
    .html文件
    .php文件
    mysql
    .php运行结果

- 网页、网站

我们可以通过浏览器上网看到的精美页面，一般都是经过浏览器渲染过的.html页面，其中包含了css等前端技术。多个网页的集合就是网站。

- Web容器

Web容器，也叫Web服务器，主要提供Web服务，也就是常说的HTTP服务。
常见的Web容器有：Apache/IIS/Nginx等。

- 静态的网页

静态的网页，都是一些.html文件，是纯文本文件。这些文件中包含html代码。
HTML(HyperText Markup Language,超文本标记语言)，在浏览器中解释运行。

- 中间件服务器

以上这种，只能单向地给用户展示信息。随着Web的发展，信息要双向流动，产生了交互的需求，也就是动态网页的概念；所谓动态就是利用flash、php、asp、Java等技术在网页中嵌入一些可运行的脚本，用户浏览器在解释页面时，遇到脚本就启动运行它。

脚本的使用让Web服务模式有了“双向交流”的能力，Web服务模式也可以像传统软件一样进行各种事务处理，如编辑文件、利息计算、提交表单等，Web架构的适用面大大扩展。

这些脚本可以嵌入在页面中，如JS等。也可以以文件的形式单独存放在Web服务器的目录里，如.asp、.php、.jsp文件等。这样功能性的脚本越来越多，形成常用的工具包，单独管理，Web业务开发时，直接使用就可以了，这就是中间件服务器，它实际上是Web服务器处理能力的扩展。
 Weblogic
 Jboss

- 数据库的出现

静态网页与脚本都是事先设计好的，一般不经常改动，但网站上很多内容需要经常的更新，如新闻、博客文章、互动游戏等，这些变动的数据放在静态的程序中显然不合适，传统的办法是数据与程序分离，采用专业的数据库。Web开发者在Web服务器后边增加一个数据库服务器，这些经常变化的数据存进数据库，可以随时更新。当用户请求页面时，脚本根据用户请求的页面，涉及到动态数据的地方，利用SQL数据库语言，从数据中读取最新的数据，生成“完整”页面，最后送给用户。

HTTP协议概述

HTTP（HyperText Transfer Protocol,超文本传输协议）是浏览器与Web服务器之间的通信协议，是传递消息的规范和要求。

- 概述
 @ 1990年提出的，当前版本1.1
 @ HTTP是用来将html文档从Web服务器传输到Web浏览器
 @ 是一个请求和响应的协议。客户端发出请求，服务器端对请求给出回应
 @ HTTP使用可靠的TCP连接，默认端口80

- 特点
@ 支持浏览器/服务器模式
@ 简单快速：浏览器向服务器提出请求时，只需要传送请求方法和请求路径
@ 灵活：HTTP运行传输任意类型的数据对象
   .html     纯文本
   .jpg      图片
   .mp3      音频
@ HTTP协议是无状态的协议

- URL
统一资源定位符（网址），用来告诉Web容器，浏览器所请求资源（文件）的路径。
schema://login:password@address:port/path/to/resource/?query_string#fragment

port     80
login    用户名
password 密码   匿名访问时，默认没有这两个内容
fragment 锚点   实现页面内定位
@ URL编码
URL中允许出现的字符时有限制的，URL中path开始允许直接出现A-Za-z0-9
半角减号(-)、下划线句点(.)、波浪号(~)。其他字符均会被百分号编码。
如下：
  #   %23
  []  %20
  @ 报文分析工具
  在进行编码的时候，空格一般用[+]代替
  1. F12
  2. wireshark
  3. fiddler
  ...

HTTP报文分析

HTTP请求由请求行、请求头、请求正文三个部分组成
1. 请求行：方法，资源路径，协议/版本
2. 请求头
从请求报文第二行开始到第一个空行为止之间的内容。

@ 主要字段

Host 主要用于指定被请求资源的Internet主机和端口号
User-Agent 浏览器指纹
Referer 包含一个URL，代表当前URL的上一个URL
Cookie  记录请求者的身份认证信息
Accept-Charset 用于指定客户端接收的字符集
Content-Type  用于向接收方指示实体的介质类型
Content-Length  用于指明实体正文的长度，以字节方式存储的十进制数字来表示
Last-Modified  用于指示资源的最后修改时间和日期

- RESPONSE
  响应报文，如下
    响应报文由状态行、响应报头、响应正文三部分组成
    1. 状态行：协议/版本，状态代码，描述短语
    2. 响应报头
    第二行开始到第一个空行为止的所有内容，其中包含了关于HTTP响应的重要字段
    3. 响应正文
    服务器返回资源的内容，即浏览器接收到的HTML代码

@ 状态码
100~199  信息性状态码
200~299  成功状态码
300~399  重定向状态码
400~499  客户端错误状态码
500~500 服务器错误状态码

@ 主要字段
Server 服务器指纹
Set-Cookie 向服务器端设置Cookie
Last-Modified 服务器通过这个头信息告诉浏览器，资源的最后修改时间
Content-Length 请求正文的长度
Location 重定向目标页面
Refresh  服务器通过Refresh头告诉浏览器定时刷新浏览器
Cookie与Session机制

方法：
  GET
    GET是最常用的方法，通常用于请求服务器发送的某个资源
  POST
    POST方法可以向服务器提交参数以及表单，包括文件流等
  HEAD
    与GET方法类似，但在服务器响应中只返回首部
  PUT
    与GET从服务器读取文档相反，PUT方法会向服务器写入文档
  TRACE
    回显浏览器的请求
  OPTIONS
    OPTIONS方法请求Web服务器告知其支持的各种功能
  DELETE
    DELETE方法请求服务器删除请求URL所指定的资源
    
- 同源策略的条件
 @ URL的主机(FQDN:Fully Qualified Domain Name 全称域名)一致
 @ Schema 一致
 @ 端口号一致
 同源策略的保护对象不仅仅是iframe内的文档。比如，实现Ajax时使用的XMLHttpRequest对象能够访问的URL也受到了同源策略的限制

 