# IP包头分析与静态路由

### IP数据包格式
版本（4） 首部长度（4） 优先级与服务类型（8） 总长度（16）
标识符（16） 标志（3） 段偏移量（13）
TTL（8） 协议号（8） 首部校验和（16）
源地址（32）
目标地址（32）（此前20个字节，IP数据包最少20字节，最长为60字节）
可选项
数据
单位（比特）（20-60个字节）

版本：IPV4或IPV6（0800 IP 0806 ARP）
首部长度：一般为20，用来标识IP包头长度
优先级与服务类型：前面3个优先级，后面4个服务类型，最后一个未被启用，保留（QOS TOS） 专线 一般运营商使用
总长度：IP包的总长度

ip分片 由于数据链路层帧长度为1500，所以要将包切片，ip包头的20字节每个片都需要有，数据分割
网络层分片（总长度超过1500进行分片，即MTU为1500，国内大多为，但也有其他大小）

标识符：发送端随机生成，用于标识是否为同一包
标志：第一个比特未启用，第二个比特为1则未分片，为0则分片，第三个比特表明是否为最后一个分片，为1还有后续
段偏移量：决定同一包内的先后顺序（0和1480的倍数）
漏洞：段偏移量更改，已修复，（类似DDOS攻击，无法避免）
流量清洗（防止DDOS攻击）

TTL(time to live)  一般在100以上为win主机，100以下为linux主机（0-255） 包的生存时间，值为0会被干掉，255为网络设备
作用：防止一个数据包在网络中永久的循环下去

协议号：6为TCP 17为UDP 1为同层ICMP

首部校验和：校验三层IP包头（20-60字节）

IGMP （网关协议）

路由

- 跨越从源主机到目标主机的一个互联网来转发数据包的过程
（路由器为IP包选择路径的过程）
路由表一般不会自动学习，需要手动配
C 直连
手工配的写S 静态路由
下一跳ip地址

路由器的路由依据是路由表

IPv4 32位 IPv6 128位（IPv6都已分配好地区）
127开头的为回环地址
0.0.0.0代表所有IP地址 0.0.0.0 0.0.0.0代表所有网段
路由表中带*的为手工配的默认路由，配置默认路由的路由表不会丢弃数据
直连路由器也叫边缘路由器，路由器会先检查优先级（管理距离值，C为0，S为1，S*为无穷大，值越小优先级越大）
优先级低的会被隐藏（浮动路由，当优先级高的路由消失后会浮现）

交换与路由对比
路由工作在网络层
- 根据“路由表”转发数据
- 路由选择
- 路由转发

交换工作在数据链路层
- 根据“MAC地址表”转发数据
- 硬件转发

```
静态路由配置
Router(config)# ip route network mask {address | interface}
默认路由的配置
Router(config)# ip route 0.0.0.0 0.0.0.0 address 

静态路由：
conf t
ip route 目标网段 子网掩码 下一跳IP
如： ip route 70.1.1.0 255.255.255.0 20.1.1.2

浮动路由：
在静态或默认路由后加空格+数字（正整数）
```