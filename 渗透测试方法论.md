# 渗透测试方法论

渗透测试（penetration testing,pentest）是实施安全评估（即审计）的具体手段。
方法论是在制定、实施信息安全审计方案时，需要遵循的规则、惯例和过程。人们在评估网路、应用、系统或三者组合的安全状况时，不断摸索各种务实的理念和成熟的做法，并总结了一套理论-渗透方法测试论

渗透测试的种类
- 黑盒测试

在进行黑盒测试时，安全审计员在不清楚被测单位的内部技术构造的情况下，从外部评估网络基础设施的安全性
在渗透测试的各个阶段，黑盒测试借助真实世界的黑客技术，暴露出目标的安全问题，甚至可以揭露尚未被他人利用的安全弱点。
渗透测试人员应能理解安全弱点，将之分类并按照风险等级（高、中、低）对其排序。通常来说，风险级别取决于相关弱点可能形成危害的大小。老练的渗透测试专家应能够确定可引发安全事故的所有攻击模式。当测试人员完成黑盒测试的所有测试工作之后，他们会把与测试对象安全状况有关的必要信息进行整理，并使用业务的语言描述这些被识别出来的风险，继而将之汇总为书面报告，黑盒测试的市场报价通常会高于白盒测试

- 白盒测试

白盒测试的审计员可以获取被侧单位的各种内部资料甚至不公开资料，所以渗透测试人员的视野更为开阔。若以白盒测试的方法评估安全漏洞，测试人员可以以最小的工作量达到最高的评估精确度。白盒测试从被测系统环境自身出发，全面消除内部安全问题。从而增加了从单位外部渗透系统的难度。黑盒测试起不到这样的作用。白盒测试所需要的步骤数目与黑盒测试不相上下，就可以在入侵者发现甚至利用安全弱点之前，尽可能最早地消除全部安全隐患。这使得白盒测试的时间、成本，以及发现、解决安全弱点的技术门槛都全面低于黑盒测试

- 脆弱性评估与渗透测试

脆弱性评估通过分析企业资产面临安全威胁的情况盒程度，评估内部和外部的安全控制的安全性。这种技术上的信息系统评估，不仅仅揭露现有防范措施里存在的风险，而且要提出多重备选的补救策略，并将这些策略进行比较。内部的脆弱性评估可保证内部系统的安全性，而外部的脆弱性评估则是验证边界防护(perimeter defenses)的有效性。无论进行内部脆弱性评估还是进行外部脆弱性评估，评估人员都会采用各种攻击模式来严格测试网络资产的安全性，从而验证信息系统处理安全威胁的能力，进而确定应对措施的有效性。不同类型的脆弱性评估需要的测试流程、测试工具和自动化测试技术也不相同。这可以通过一体化的安全弱点管控平台(vulnerability management)来实现。现在的安全弱点管理平台带有可自动更新的漏洞数据库，能够测试不同类型的网络设备，而且不会影响配置管理和变更管理的完整性。

脆弱性评估和渗透测试两者最大的区别就是：渗透测试不仅要识别目标的弱点，他还设计在目标系统上进行漏洞利用、权限提升和访问维护。换句话说，脆弱性评估虽然可以充分发现系统里的缺陷，但是不会考虑去衡量这些缺陷对系统造成的危害。另外，相比脆弱性评估，渗透测试更倾向于入侵，会刻意使用各种技术手段利用安全漏洞；所以渗透测试可能对生产环境带来实际的破坏性影响。而脆弱性评估以非入侵的方式，定性、定量得识别已知安全弱点。

## 安全措施方法论

- 开放式Web 应用程序安全项目(Open Web Application Security Project,OWASP)/github
[http://www.owasp.org.cn/]
@ 测试指南
[https://www.owasp.org/index.php/PWASP_Testing_Project]
@ 开发人员指南
[https://www.owasp.org/index.php/OWASP_Guide_Project]
@ 代码审查指南
OWASP top 10
Web 十大安全漏洞
[https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project]


- 通用缺陷列表(Common Weakness Enumeration,CWE)
   CWE-79:XSS 漏洞
   [http://cwe.mitre.org/data/definitions/79.html]

   CWE-89:SQLi
   [http://cwe.mitre.org/data/definitions/89.html]

- 通用漏洞与披露(Common Vulnerabilities and Exposures,CVE)
  [http://cve.scap.org.cn/]
  [http://cve.mitre.org/]

- MS17-010
  微软17年发布的第10个安全公告（一个安全公告就是一个安全漏洞）

- S2-053
  struts2
    Apache 开源开发java的框架

- 其他方法论
  @ 开源安全测试方法论(Open Source Security Testing Methodology Manual,OSSTMM)
  [http://www.isecom.org/research.osstmm.html]
  @ 信息系统安全评估框架(Information Systems Security Assessment Framework,ISSAF)
  [http://www.oissg.org/issaf]
  @ Web应用安全联合威胁分类(Web Application Security Consortium Threat Classification,WASC-TC)
  [http://projects.webappsec.org]

# 渗透测试流程

- 渗透测试执行标准
  渗透测试执行标准(Penetration Testing Execution Standard,PTES)的先驱都是渗透测试行业的精英。这个标准有渗透测试7个阶段的标准组成，可以在任意环境中进行富有成果的渗透测试
  [http://www.pentest-standard.org/index.php/Main_Page]

  @ 7个阶段
  1. 事前互动
  2. 情报收集
  3. 威胁建模
  4. 漏洞分析
  5. 漏洞利用
  6. 深度利用
  7. 书面报告

  @ 主要特点优势

  PTES的主要特性和优势如下
  1. 它是非常全面的渗透测试框架，涵盖了渗透测试的技术方面和其他重要方面，如范围蔓延(scope creep)、报告，以及渗透测试人员保护自身的方法。
  2. 它介绍了多数测试任务的具体方法，可指导您准确测试目标系统的安全状态
  3. 它汇聚了多名日行一“渗”的渗透测试专家的丰富经验。
  4. 它包含了最常用的以及很罕见的相关技术
  5. 它浅显易懂，您可根据测试工作的需要对相应测试步骤进行调整

- 通用渗透测试框架

从技术管理的角度来看，遵循正规的测试框架对安全测试极为重要。通用渗透测试框架涵盖了典型的审计测试工作和渗透测试工作会涉及到的各个阶段。

  相关阶段如下：
  1. 范围界定
  2. 信息收集
  3. 目标识别
  4. 服务枚举
  5. 漏洞映射
  6. 社会工程学
  7. 漏洞利用
  8. 权限提升
  9. 访问维护
  0. 文档报告

无论进行白盒测试还是黑盒测试，选择和使用测试步骤都是测试人员的责任。在测试开始前，测试人员需要根据目标系统的实际环境和已掌握的相关目标系统的情况，再指定最佳的测试策略。
 
 @ 范围界定

 在开始技术性安全评估之前，务必要观察、研究目标环境的被测范围。同时还要了解，这个范围牵扯了多少个单位，是单个单位还是多个单位会参与到安全评估的工作中来，在范围界定阶段，需要考虑的典型因素如下：
   1. 测试对象是什么？
   2. 应当采取何种测试方法？
   3. 有哪些在测试过程中需要满足的条件？
   4. 哪些因素可能会限制测试执行的过程
   5. 需要多久才能完成测试？
   6. 此次测试应当达成什么样的任务目标？

@ 信息收集

在划定了测试范围之后，就需要进入信息收集阶段。在这个阶段，渗透人员需要使用各种公开资源尽可能地获取测试目标的相关信息。他们从互联网上收集信息的主要渠道有：
  论坛|公告板|新闻组|媒体文章|博客|社交网络|其他商业或非商业性的网站
此外，他们也可以借助各种搜索引擎中获取相关数据，如谷歌、雅虎、MSN必应、百度等。收集的信息主要包括DNS 服务器、路由关系、whois、数据库、电子邮件地址、电话号码、个人信息以及用户账户。收集的信息越多，渗透测试成功的概率就越高。

@ 目标识别

这个阶段的主要任务使识别目标的网络状态、操作系统和网络架构。该阶段工作旨在完整地展现目标网络里各种联网设备或技术的完整关系，一帮助测试人员在接下来的工作里枚举目标网络的各种服务。

@ 服务枚举

这一阶段会根据前面各个阶段的成果，进一步找出目标系统中所有开放的端口。一旦找到了所有开放的端口，就可以通过这些端口来列出目标系统上运行的服务。主机上开放的端口都有相应的服务程序，对这些信息进行深度分析之后，可进一步发掘目标网络基础设施中可能存在的漏洞。

@ 漏洞映射（漏洞扫描）

可以根据已经发现的开放端口和服务程序，查找、分析目标系统中存在的漏洞。如果能够采用自动和手动这两种不同的测试方法结合起来，审计人员对目标系统的认知就会更为清晰、透彻，并能够仔细地检查任何已知和未知的漏洞。

@ 社会工程学

如果目标网络没有直接的入口，欺骗的艺术将起到抛砖引玉的重要作用。对目标组织中的人员进行定向攻击，很有可能帮助我们找到渗透目标系统的入口。例如，诱使用户运行安装后门的恶意程序，就可能为审计人员的渗透工作形成突破。社会工程学渗透分为多种不同的实现形式。伪装成网络管理员，通过电话要求用户提供自己的账户信息；发送钓鱼软件来劫持用户的银行账户；甚至诱使某人出现在某个地点-这些都属于社会工程学攻击。再社会工程学中，达成同一既定目标的实现方式应有尽有。需要注意的是，在对目标实施欺骗以达成渗透目标之前，您需要研究当地的法律是否有关于社会工程学的相关条款。

@ 漏洞利用

在仔细检查和发现目标系统中的漏洞之后，就可以使用已知的漏洞利用程序对目标系统进行渗透。审计人员可以把客户端漏洞利用程序和社会工程学进行结合，进而控制目标系统。这个阶段的主要内容使控制目标系统。这个流程可以分为三步，涉及攻击前、攻击、攻击后的相关行动。

@ 权限提升

获取目标系统的控制权势渗透成功的标识。接下来，审计人员就可以根据其所拥有的访问权限，在被测系统中自由发挥。审计人员也可以使用于目标系统的本地漏洞来提升自己的权限。只要他们能在目标系统上运行提权漏洞利用程序，就可以获得主机的超级用户权限或者系统级权限。审计人员还可以以该主机为跳板，进一步攻击局域网络。根据之前渗透范围的界定，审计人员接下来会开展的攻击可能是受限制的，也可能是不受限制。然后，他们很有可能以各种方式获得与控制系统有关的更多信息，在局域网络中使用网络欺骗手段。所以说，提升权限的最终目的是获得目标系统的最高访问权限。

